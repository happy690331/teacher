<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§è€ƒè€ƒè©¦æé†’ - é»‘æ¿é¢¨æ ¼</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å¯æ„›çš„åœ“é«”å­—å‹ -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* å…¨å±€å­—å‹èˆ‡èƒŒæ™¯ */
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #111;
            margin: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* 16:9 å®¹å™¨ */
        .ratio-wrapper {
            width: 100%;
            max-width: 100%;
            aspect-ratio: 16 / 9;
            max-height: 100vh;
            display: flex;
            position: relative;
        }

        /* é»‘æ¿è³ªæ„ŸèƒŒæ™¯ */
        .blackboard {
            flex: 1;
            background-color: #1a472a;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.05) 0%, transparent 20%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5), 0 0 20px rgba(0,0,0,0.3);
            border: 1.5vh solid #8B4513;
            border-radius: 10px;
            color: #eee;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 1.5vh;
            gap: 1.5vh;
        }

        /* ç²‰ç­†ç·šæ¢é‚Šæ¡† */
        .chalk-border {
            border: 3px solid rgba(255, 255, 255, 0.7);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            background: rgba(255, 255, 255, 0.05);
            height: 100%; 
            box-sizing: border-box;
            min-width: 0; 
            min-height: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .highlight-text {
            color: #ffeb3b;
            text-shadow: 0 0 8px rgba(255, 235, 59, 0.6);
        }

        /* è¨­å®šé é¢æ¨£å¼ */
        .setup-card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: absolute;
            z-index: 50;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
        }

        /* è‡ªè¨‚é¸å–æ¡†æ¨£å¼ */
        .order-box {
            width: 2rem;
            height: 2rem;
            border: 2px solid #cbd5e1;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.1rem;
            transition: all 0.2s;
            background-color: white;
            color: transparent;
        }
        
        /* é¸ä¸­ç‹€æ…‹ */
        .order-box.active {
            background-color: #15803d; /* green-700 */
            border-color: #15803d;
            color: white;
        }

        /* çƒé¾œå‹•ç•«å®¹å™¨ */
        .turtle-wrapper {
            position: absolute;
            bottom: -8px; 
            transform: translateX(-50%);
            transition: left 1s linear;
            width: 90px;
            height: 70px;
            z-index: 10;
        }
        
        .cheering svg {
            animation: bounce 0.6s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .hidden { display: none !important; }
        .flex { display: flex; }

        /* --- ä½ˆå±€ç³»çµ± (Rows) --- */
        .row-container {
            display: flex;
            width: 100%;
            gap: 1.5vh;
        }

        /* ä¸Šå±¤ (A+B) */
        .row-top { height: 35%; }
        .area-a { width: 40%; }
        .area-b { width: 60%; }

        /* ä¸­å±¤ (C+D) */
        .row-middle { height: 47%; }
        .area-c { width: 55%; }
        .area-d { width: 45%; }

        /* ä¸‹å±¤ (E) */
        .row-bottom { height: 18%; }
        .area-e { width: 100%; }


        /* --- å­—é«”èˆ‡æ¨£å¼èª¿æ•´ --- */
        
        /* Aå€: ä»Šæ—¥è€ƒç¨‹ (å–®ç§‘é¡¯ç¤º) */
        #schedule-single-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .current-subject {
            font-size: 10vh; /* æ”¾å¤§é¡¯ç¤ºç§‘ç›® */
            font-weight: 900;
            line-height: 1.1;
            color: #ffeb3b;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }
        
        .current-time {
            font-size: 5vh; /* æ”¾å¤§é¡¯ç¤ºæ™‚é–“ */
            font-family: monospace;
            opacity: 0.9;
            margin-top: 1vh;
        }

        /* Bå€: ç¾åœ¨æ™‚é–“ (æ”¾å¤§) */
        #digital-clock { 
            font-size: 14vh; /* ç¶­æŒæ”¾å¤§ */
            line-height: 1;
        }
        
        /* Cå€: äººæ•¸ (æ–‡å­—åœ¨ä¸Šï¼Œæ•¸å­—åœ¨ä¸‹) */
        .stat-group {
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            height: 100%;
            justify-content: center;
            align-items: center;
        }
        
        .stat-number { 
            font-size: 11vh; 
            line-height: 1;
            order: 2; /* æ•¸å­—åœ¨ä¸‹ */
        } 
        
        .stat-label { 
            font-size: 4.5vh; 
            font-weight: bold;
            opacity: 0.9;
            margin-bottom: 0.5vh;
            order: 1; /* æ–‡å­—åœ¨ä¸Š */
        }
        
        /* Då€: è€ƒç”Ÿæ³¨æ„ (ç¶­æŒæ”¾å¤§ï¼Œä¸¦æ”¯æ´é•·æ–‡å­—) */
        #reminder-text { 
            font-size: 6vh; 
            line-height: 1.3;
            white-space: pre-wrap;
            font-weight: 700;
        } 
        
        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

    </style>
</head>
<body>

    <!-- 16:9 å¤–æ¡†å®¹å™¨ -->
    <div class="ratio-wrapper">

        <!-- ç¬¬ä¸€é ï¼šè¨­å®šç•«é¢ -->
        <div id="setup-screen" class="setup-card p-8 text-gray-800">
            <h1 class="text-3xl font-bold text-center mb-6 text-green-700">ğŸ“ å¤§è€ƒç›£æ§è¨­å®š</h1>
            
            <form id="exam-form" class="space-y-4">
                <!-- 1. é¸æ“‡ç§‘ç›® (ä¾ç…§é»æ“Šé †åº) -->
                <div>
                    <label class="block text-lg font-bold mb-2">1. é¸æ“‡è€ƒè©¦ç§‘ç›® (æ•¸å­—ä»£è¡¨è€ƒè©¦é †åº)</label>
                    <div class="grid grid-cols-3 gap-3">
                        <!-- é¸é … 1: åœ‹èª -->
                        <label class="flex items-center space-x-2 cursor-pointer p-2 border rounded hover:bg-gray-50 select-none">
                            <input type="checkbox" name="subject" value="åœ‹èª" class="hidden">
                            <div class="order-box"></div>
                            <span class="text-xl">åœ‹èª</span>
                        </label>
                        <!-- é¸é … 2: æ•¸å­¸ -->
                        <label class="flex items-center space-x-2 cursor-pointer p-2 border rounded hover:bg-gray-50 select-none">
                            <input type="checkbox" name="subject" value="æ•¸å­¸" class="hidden">
                            <div class="order-box"></div>
                            <span class="text-xl">æ•¸å­¸</span>
                        </label>
                        <!-- é¸é … 3: è‡ªç„¶ -->
                        <label class="flex items-center space-x-2 cursor-pointer p-2 border rounded hover:bg-gray-50 select-none">
                            <input type="checkbox" name="subject" value="è‡ªç„¶" class="hidden">
                            <div class="order-box"></div>
                            <span class="text-xl">è‡ªç„¶</span>
                        </label>
                        <!-- é¸é … 4: ç¤¾æœƒ -->
                        <label class="flex items-center space-x-2 cursor-pointer p-2 border rounded hover:bg-gray-50 select-none">
                            <input type="checkbox" name="subject" value="ç¤¾æœƒ" class="hidden">
                            <div class="order-box"></div>
                            <span class="text-xl">ç¤¾æœƒ</span>
                        </label>
                        <!-- é¸é … 5: è‹±æ–‡ -->
                        <label class="flex items-center space-x-2 cursor-pointer p-2 border rounded hover:bg-gray-50 select-none">
                            <input type="checkbox" name="subject" value="è‹±æ–‡" class="hidden">
                            <div class="order-box"></div>
                            <span class="text-xl">è‹±æ–‡</span>
                        </label>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">æç¤ºï¼šé»æ“Šçš„é †åºå³ç‚ºè€ƒè©¦é †åº (1, 2, 3...)</p>
                </div>

                <!-- 2. äººæ•¸è¨­å®š -->
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-bold mb-2">2. æ‡‰åˆ°äººæ•¸</label>
                        <select id="expected-count" class="w-full p-2 border rounded text-lg">
                            <!-- JS ç”Ÿæˆ 1-10 -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-bold mb-2">3. å¯¦åˆ°äººæ•¸</label>
                        <select id="actual-count" class="w-full p-2 border rounded text-lg">
                            <!-- JS ç”Ÿæˆ 1-10 -->
                        </select>
                    </div>
                </div>

                <!-- é è¦½ç¼ºè€ƒ -->
                <div class="bg-gray-100 p-3 rounded text-center">
                    <span class="text-lg">ç¼ºè€ƒäººæ•¸å°‡è‡ªå‹•è¨ˆç®—ï¼š <span id="absent-preview" class="font-bold text-red-600">0</span> äºº</span>
                </div>

                <button type="submit" class="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-3 px-4 rounded-lg text-xl transition transform hover:scale-105">
                    é–‹å§‹è€ƒè©¦ç›£æ§ <i class="fas fa-play ml-2"></i>
                </button>
            </form>
        </div>

        <!-- ç¬¬äºŒé ï¼šé»‘æ¿å„€è¡¨æ¿ (åˆå§‹éš±è—) -->
        <div id="monitor-screen" class="blackboard hidden">
            
            <!-- ç¬¬ä¸€åˆ—ï¼šè€ƒç¨‹ + æ™‚é–“ (é«˜35%) -->
            <div class="row-container row-top">
                <!-- Aå€ï¼šè€ƒè©¦ç§‘ç›®èˆ‡æ™‚é–“ (çª„ 40%) -->
                <div class="area-a chalk-border p-4">
                    <div id="schedule-single-container">
                        <div id="sched-subject" class="current-subject">æº–å‚™ä¸­</div>
                        <div id="sched-time" class="current-time">--:--</div>
                    </div>
                </div>

                <!-- Bå€ï¼šç¾åœ¨æ™‚é–“ (å¯¬ 60%) -->
                <div class="area-b chalk-border p-2 items-center justify-center">
                    <div style="font-size: 2.5vh" class="mb-0 opacity-80">ç¾åœ¨æ™‚é–“</div>
                    <div id="digital-clock" class="font-bold tracking-widest highlight-text" style="font-family: monospace;">
                        00:00:00
                    </div>
                </div>
            </div>

            <!-- ç¬¬äºŒåˆ—ï¼šäººæ•¸ + æ³¨æ„äº‹é … (é«˜47%) -->
            <div class="row-container row-middle">
                <!-- Cå€ï¼šäººæ•¸çµ±è¨ˆ (å¯¬ 55%) -->
                <div class="area-c chalk-border p-2 justify-center">
                    <h2 class="font-bold border-b-2 border-dashed border-white/30 pb-1 mb-2">
                        <i class="fas fa-users mr-2"></i>äººæ•¸çµ±è¨ˆ
                    </h2>
                    <div class="grid grid-cols-3 gap-2 text-center h-full items-center pb-2">
                        <!-- æ‡‰åˆ° -->
                        <div class="stat-group">
                            <span class="stat-label">æ‡‰åˆ°</span>
                            <span class="stat-number font-black text-white" id="disp-expected">?</span>
                        </div>
                        <!-- å¯¦åˆ° -->
                        <div class="stat-group border-l border-r border-white/20">
                            <span class="stat-label">å¯¦åˆ°</span>
                            <span class="stat-number font-black text-yellow-300" id="disp-actual">?</span>
                        </div>
                        <!-- ç¼ºè€ƒ -->
                        <div class="stat-group">
                            <span class="stat-label">ç¼ºè€ƒ</span>
                            <span class="stat-number font-black text-pink-400" id="disp-absent">?</span>
                        </div>
                    </div>
                </div>

                <!-- Då€ï¼šæé†’äº‹é … (å¯¬ 45%) -->
                <div class="area-d chalk-border p-2 relative">
                    <h2 class="font-bold border-b-2 border-dashed border-white/30 pb-1 mb-2 text-pink-300">
                        <i class="fas fa-bullhorn mr-2"></i>è€ƒç”Ÿæ³¨æ„
                    </h2>
                    <div class="flex-1 flex items-center justify-center text-center px-4 w-full overflow-hidden">
                        <p id="reminder-text" class="font-bold transition-opacity duration-500 opacity-100 w-full break-words">
                            æº–å‚™è€ƒè©¦...
                        </p>
                    </div>
                </div>
            </div>

            <!-- ç¬¬ä¸‰åˆ—ï¼šçƒé¾œ (é«˜18%) -->
            <div class="row-container row-bottom">
                <div class="area-e chalk-border px-8 py-1 relative flex flex-col justify-center">
                    <!-- æ¨™é¡Œ -->
                    <div class="absolute top-1 left-4 text-white/70" style="font-size: 2vh;">
                        <i class="fas fa-stopwatch mr-2"></i>
                        <span id="current-exam-status" class="ml-2 text-yellow-300">ä¼‘æ¯æ™‚é–“</span>
                    </div>

                    <!-- è³½é“å®¹å™¨ -->
                    <div class="relative w-full h-10 mt-4">
                        <!-- èµ·é»ç·š -->
                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-white/50 flex flex-col items-center justify-end">
                            <span class="text-xs mb-[-18px]">Start</span>
                        </div>
                        
                        <!-- è·‘é“ç·š -->
                        <div class="absolute top-3/4 left-0 right-0 border-b-4 border-dashed border-white/40"></div>

                        <!-- çµ‚é»ç·šèˆ‡æ——å­ -->
                        <div class="absolute right-0 top-0 bottom-0 w-1 bg-white/50 flex flex-col items-center justify-end">
                            <i class="fas fa-flag text-red-500 text-2xl absolute -top-5 animate-pulse"></i>
                            <span class="text-xs mb-[-18px]">Finish</span>
                        </div>

                        <!-- çƒé¾œ (SVG) -->
                        <div id="turtle" class="turtle-wrapper" style="left: 0%;">
                            <svg viewBox="0 0 100 80" width="100%" height="100%" style="filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.4));">
                                <!-- èº«é«”/è…³ -->
                                <circle cx="30" cy="65" r="8" fill="#8BC34A" />
                                <circle cx="70" cy="65" r="8" fill="#8BC34A" />
                                <ellipse cx="50" cy="60" rx="35" ry="12" fill="#8BC34A" />
                                <!-- å°¾å·´ -->
                                <path d="M15,55 Q5,60 15,65" fill="#8BC34A" stroke="#558B2F" stroke-width="2" />
                                <!-- é¾œæ®¼ -->
                                <path d="M20,55 Q20,15 50,15 Q80,15 80,55 Z" fill="#66BB6A" stroke="#33691E" stroke-width="3"/>
                                <!-- é¾œæ®¼èŠ±ç´‹ -->
                                <circle cx="50" cy="35" r="8" fill="#4CAF50" opacity="0.6"/>
                                <circle cx="35" cy="48" r="6" fill="#4CAF50" opacity="0.6"/>
                                <circle cx="65" cy="48" r="6" fill="#4CAF50" opacity="0.6"/>
                                <!-- é ­éƒ¨ -->
                                <circle cx="88" cy="40" r="14" fill="#8BC34A" stroke="#33691E" stroke-width="2"/>
                                <!-- çœ¼ç› -->
                                <ellipse cx="90" cy="36" rx="3" ry="4" fill="black"/>
                                <circle cx="91" cy="35" r="1" fill="white"/>
                                <!-- è…®ç´… -->
                                <circle cx="82" cy="42" r="2.5" fill="#F48FB1" opacity="0.6"/>
                                <!-- å˜´å·´ -->
                                <path d="M92,45 Q88,48 84,44" fill="none" stroke="#33691E" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- è³‡æ–™èˆ‡ç‹€æ…‹ ---
        const setupScreen = document.getElementById('setup-screen');
        const monitorScreen = document.getElementById('monitor-screen');
        const form = document.getElementById('exam-form');
        const expectedSel = document.getElementById('expected-count');
        const actualSel = document.getElementById('actual-count');
        const absentPrev = document.getElementById('absent-preview');
        
        // è€ƒç¨‹é¡¯ç¤ºå…ƒç´ 
        const schedSubjectEl = document.getElementById('sched-subject');
        const schedTimeEl = document.getElementById('sched-time');

        // å›ºå®šæ™‚æ®µ (æ ¼å¼: HH:mm)
        const TIME_SLOTS = [
            { start: "08:40", end: "09:20" }, 
            { start: "09:35", end: "10:15" }, 
            { start: "10:30", end: "11:00" }, 
            { start: "11:20", end: "12:00" }, 
            { start: "13:30", end: "14:10" }  
        ];

        // æé†’äº‹é …
        const REMINDERS = [
            "æ‹¿åˆ°è€ƒå·å…ˆå¯«åå­— âœï¸",
            "æ¡Œä¸Šåªæœ‰é‰›ç­†ã€æ©¡çš®æ“¦ã€è€ƒå· âœï¸",
            "ä¸æœƒçš„é¡Œç›®å…ˆè·³é ğŸ¤”",
            "å¯«å®Œä¸€å®šè¦å†æª¢æŸ¥ä¸€éçœ‹çœ‹æœ‰ç„¡æ²’å¯« ğŸ‘€",
            "æœ‰å•é¡Œè«‹èˆ‰æ‰‹ ğŸ™‹â€â™‚ï¸",
            "ä¸è¦çœ‹åˆ¥äººï¼Œä¸è¦å”±æ­Œå’Œè£½é€ è²éŸ³ ğŸ¤«"
        ];

        let examConfig = {
            subjects: [],
            schedule: [],
            expected: 0,
            actual: 0,
            absent: 0
        };

        // --- é¸æ“‡é †åºé‚è¼¯ ---
        // å„²å­˜å·²é¸ç§‘ç›®çš„é™£åˆ—ï¼Œä¾åºæ”¾å…¥
        let selectedSubjectsOrder = [];

        // ç¶å®š checkbox äº‹ä»¶
        const subjectInputs = document.querySelectorAll('input[name="subject"]');
        subjectInputs.forEach(input => {
            input.addEventListener('change', function(e) {
                const val = e.target.value;
                if(e.target.checked) {
                    // æ–°å¢é¸æ“‡
                    selectedSubjectsOrder.push(val);
                } else {
                    // å–æ¶ˆé¸æ“‡ (éæ¿¾æ‰è©²å€¼)
                    selectedSubjectsOrder = selectedSubjectsOrder.filter(item => item !== val);
                }
                updateSubjectUI();
            });
        });

        // æ›´æ–°é¸æ“‡æ¡† UI (é¡¯ç¤º 1, 2, 3...)
        function updateSubjectUI() {
            subjectInputs.forEach(input => {
                const val = input.value;
                const orderIndex = selectedSubjectsOrder.indexOf(val);
                const orderBox = input.nextElementSibling; // div.order-box
                
                if (orderIndex > -1) {
                    // å·²é¸å–ï¼Œé¡¯ç¤ºåºè™Ÿ (index + 1)
                    orderBox.textContent = orderIndex + 1;
                    orderBox.classList.add('active');
                    // ç¢ºä¿ input æ˜¯ checked (é˜²å‘†)
                    input.checked = true; 
                } else {
                    // æœªé¸å–
                    orderBox.textContent = '';
                    orderBox.classList.remove('active');
                    input.checked = false;
                }
            });
        }

        // --- åˆå§‹åŒ–è¨­å®šé é¢ ---
        function initSetup() {
            for(let i=1; i<=10; i++) {
                let opt1 = new Option(i + " äºº", i);
                let opt2 = new Option(i + " äºº", i);
                expectedSel.add(opt1);
                actualSel.add(opt2);
            }
            expectedSel.value = 10;
            actualSel.value = 10;
            updateAbsent();
        }

        function updateAbsent() {
            let exp = parseInt(expectedSel.value);
            let act = parseInt(actualSel.value);
            
            if(act > exp) {
                actualSel.value = exp;
                act = exp;
            }

            let abs = exp - act;
            absentPrev.innerText = abs;
            return { exp, act, abs };
        }

        expectedSel.addEventListener('change', updateAbsent);
        actualSel.addEventListener('change', updateAbsent);

        // --- è¡¨å–®æäº¤ ---
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // ä½¿ç”¨ selectedSubjectsOrder (é»æ“Šé †åº) ä¾†æ’è€ƒç¨‹
            if (selectedSubjectsOrder.length === 0) {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è€ƒè©¦ç§‘ç›®ï¼");
                return;
            }

            examConfig.subjects = [];
            examConfig.schedule = [];
            
            // ä¾åºå°‡ç§‘ç›®å¡«å…¥æ™‚é–“è¡¨
            selectedSubjectsOrder.forEach((subjectName, index) => {
                if (index < TIME_SLOTS.length) {
                    examConfig.subjects.push(subjectName);
                    examConfig.schedule.push({
                        subject: subjectName,
                        start: TIME_SLOTS[index].start,
                        end: TIME_SLOTS[index].end
                    });
                }
            });

            const counts = updateAbsent();
            examConfig.expected = counts.exp;
            examConfig.actual = counts.act;
            examConfig.absent = counts.abs;

            setupScreen.classList.add('hidden');
            monitorScreen.classList.remove('hidden');
            monitorScreen.classList.add('flex');

            startMonitor();
        });

        initSetup();


        // --- å„€è¡¨æ¿é‚è¼¯ ---

        function startMonitor() {
            renderStaticInfo(); // å¡«å…¥éœæ…‹è³‡æ–™(äººæ•¸)
            updateClock(); 
            setInterval(updateClock, 1000);
            startReminderRotation();
            checkExamStatus();
            setInterval(checkExamStatus, 1000);
        }

        function renderStaticInfo() {
            document.getElementById('disp-expected').innerText = examConfig.expected;
            document.getElementById('disp-actual').innerText = examConfig.actual;
            document.getElementById('disp-absent').innerText = examConfig.absent;
        }

        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-GB', { hour12: false });
            document.getElementById('digital-clock').innerText = timeStr;
        }

        let reminderIndex = 0;
        function startReminderRotation() {
            const textEl = document.getElementById('reminder-text');
            
            const showReminder = () => {
                textEl.style.opacity = 0;
                setTimeout(() => {
                    textEl.innerText = REMINDERS[reminderIndex];
                    reminderIndex = (reminderIndex + 1) % REMINDERS.length;
                    textEl.style.opacity = 1;
                }, 500);
            };

            showReminder();
            setInterval(showReminder, 20000);
        }

        // --- æ ¸å¿ƒé‚è¼¯: çƒé¾œ + è€ƒç¨‹é¡¯ç¤ºæ›´æ–° ---
        function checkExamStatus() {
            const now = new Date();
            // æ¸¬è©¦ç”¨ï¼šè§£é™¤è¨»è§£å¯æ¸¬è©¦ç‰¹å®šæ™‚é–“
            // now.setHours(16, 0, 0); 

            const currentTimeVal = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

            let activeExamIndex = -1;
            let percent = 0;
            let statusMsg = "ä¼‘æ¯æ™‚é–“";
            
            // æ‰¾å‡ºè¦é¡¯ç¤ºçš„ç§‘ç›® (ç•¶å‰ æˆ– ä¸‹ä¸€ç¯€)
            let displaySubject = "";
            let displayTime = "";
            let foundDisplay = false;

            // 1. å…ˆæ‰¾æ­£åœ¨é€²è¡Œçš„
            for(let i=0; i<examConfig.schedule.length; i++) {
                const slot = examConfig.schedule[i];
                const startParts = slot.start.split(':').map(Number);
                const endParts = slot.end.split(':').map(Number);
                const startSec = startParts[0] * 3600 + startParts[1] * 60;
                const endSec = endParts[0] * 3600 + endParts[1] * 60;

                // åˆ¤æ–·æ˜¯å¦ç‚ºè€ƒè©¦æœŸé–“
                if (currentTimeVal >= startSec && currentTimeVal <= endSec) {
                    activeExamIndex = i;
                    
                    // è¨ˆç®—çƒé¾œé€²åº¦
                    const duration = endSec - startSec;
                    const elapsed = currentTimeVal - startSec;
                    percent = (elapsed / duration) * 100;
                    statusMsg = `æ­£åœ¨è€ƒè©¦ï¼š${slot.subject}`;
                    
                    // é¡¯ç¤ºè¨­å®š
                    displaySubject = slot.subject;
                    displayTime = `${slot.start} - ${slot.end}`;
                    foundDisplay = true;
                    break;
                }
            }

            // 2. å¦‚æœæ²’æœ‰æ­£åœ¨é€²è¡Œçš„ï¼Œæ‰¾ä¸‹ä¸€ç¯€é‚„æ²’é–‹å§‹çš„ (ç•¶æ—¥)
            if (!foundDisplay) {
                for(let i=0; i<examConfig.schedule.length; i++) {
                    const slot = examConfig.schedule[i];
                    const startParts = slot.start.split(':').map(Number);
                    const startSec = startParts[0] * 3600 + startParts[1] * 60;
                    
                    // æ‰¾åˆ°ç¬¬ä¸€å€‹æ™‚é–“é‚„æ²’åˆ°çš„è€ƒè©¦
                    if (currentTimeVal < startSec) {
                        displaySubject = slot.subject;
                        displayTime = `${slot.start} - ${slot.end}`;
                        statusMsg = `ä¸‹ç¯€è€ƒè©¦ï¼š${slot.subject}`;
                        foundDisplay = true;
                        break;
                    }
                }
            }

            // 3. (æ–°å¢) å¦‚æœç•¶å¤©æ‰€æœ‰è€ƒè©¦éƒ½çµæŸï¼Œé¡¯ç¤ºç¬¬ä¸€ç§‘ (å¾ªç’°/éš”å¤©)
            if (!foundDisplay && examConfig.schedule.length > 0) {
                const nextSlot = examConfig.schedule[0];
                displaySubject = nextSlot.subject;
                displayTime = `${nextSlot.start} - ${nextSlot.end}`;
                statusMsg = `ä¸‹ç¯€è€ƒè©¦ï¼š${nextSlot.subject}`;
                foundDisplay = true;
            }

            // æ›´æ–° Aå€ è€ƒç¨‹é¡¯ç¤º
            schedSubjectEl.innerText = displaySubject;
            schedTimeEl.innerText = displayTime;
            
            // æ›´æ–° Eå€ ç‹€æ…‹æ–‡å­—
            document.getElementById('current-exam-status').innerText = statusMsg;

            // æ›´æ–°çƒé¾œ
            const turtle = document.getElementById('turtle');
            
            if (activeExamIndex !== -1) {
                // è€ƒè©¦ä¸­
                if(percent > 100) percent = 100;
                if(percent < 0) percent = 0;
                
                turtle.style.left = `${percent}%`;
                
                if (percent >= 99.5) {
                    turtle.classList.add('cheering');
                } else {
                    turtle.classList.remove('cheering');
                }
            } else {
                // éè€ƒè©¦æ™‚é–“ï¼Œçƒé¾œå›èµ·é»
                turtle.style.left = '0%';
                turtle.classList.remove('cheering');
            }
        }
    </script>
</body>
</html>