<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ä»Šå½©539 æ™ºæ…§é¸è™Ÿå™¨ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.box { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; }
h2 { margin-top:0 }
label { display:block; margin:6px 0; }
textarea { width:100%; height:120px; }
button { padding:10px 16px; font-size:16px; margin-right:10px; }
.result { font-size:18px; margin:6px 0; }
small { color:#555; }
</style>
</head>
<body>

<h1>ğŸ¯ ä»Šå½©539 æ™ºæ…§é¸è™Ÿå™¨</h1>

<div class="box">
<h2>ğŸ“Œ é¸è™Ÿæ©Ÿåˆ¶ï¼ˆå¯å‹¾é¸ï¼‰</h2>
<label><input type="checkbox" id="c1" checked> é¿é–‹ 3 é€£è™Ÿä»¥ä¸Šï¼ˆå« 3 / 4 / 5 é€£ï¼‰</label>
<label><input type="checkbox" id="c2" checked> é¿é–‹ç­‰å·®æ•¸åˆ—ï¼ˆæ˜é¡¯è¦å¾‹ï¼‰</label>
<label><input type="checkbox" id="c3" checked> é¿é–‹æ¥è¿‘ç­‰å·®æ•¸åˆ—</label>
<label><input type="checkbox" id="c4" checked> é¿é–‹éå»ä¸€å¹´æ›¾é–‹å‡ºçš„å®Œæ•´çµ„åˆ</label>
<label><input type="checkbox" id="c5" checked> é¿é–‹éåº¦é›†ä¸­æ–¼å°æ•¸ / å¤§æ•¸</label>
<label><input type="checkbox" id="c6" checked> å¥‡å¶æ¯”ä¾‹é™åˆ¶ç‚º 2:3 æˆ– 3:2</label>
<label><input type="checkbox" id="c7" checked> é¿é–‹éå»ä¸€å¹´é«˜é »å‡ºç¾çš„å–®ä¸€è™Ÿç¢¼ï¼ˆç†±è™Ÿï¼‰</label>
<small>â€» ç†±è™Ÿå®šç¾©ï¼šå‡ºç¾æ¬¡æ•¸å‰ 25%</small>
</div>

<div class="box">
<h2>ğŸ“¥ éå»ä¸€å¹´é–‹çè™Ÿç¢¼</h2>
<textarea id="history" placeholder="01,05,12,23,38"></textarea>
<br><br>
<input type="file" accept=".csv" onchange="loadCSV(event)">
</div>

<div class="box">
<h2>ğŸ¯ ç”¢ç”Ÿä¸­é ­ççµ„åˆ</h2>
é¸æ“‡çµ„æ•¸ï¼š
<select id="pick">
<script>
for(let i=1;i<=20;i++) document.write(`<option>${i}</option>`);
</script>
</select>
<br><br>
<button onclick="run()">é–‹å§‹ç”¢ç”Ÿ</button>
<button onclick="clearAll()">æ¸…é™¤é‡æ–°</button>
</div>

<div class="box" id="output"></div>

<script>
// ===== å·¥å…· =====
function shuffle(arr){
 for(let i=arr.length-1;i>0;i--){
  let j=Math.floor(Math.random()*(i+1));
  [arr[i],arr[j]]=[arr[j],arr[i]];
 }
 return arr;
}

function loadCSV(e){
 const r=new FileReader();
 r.onload=()=>document.getElementById("history").value=r.result.replace(/,/g,", ");
 r.readAsText(e.target.files[0]);
}

function getHotNumbers(freq){
 let list=Object.entries(freq).sort((a,b)=>b[1]-a[1]);
 let cut=Math.floor(list.length*0.25);
 return new Set(list.slice(0,cut).map(x=>+x[0]));
}

// ===== ä¸»æµç¨‹ =====
function run(){
 const lines=document.getElementById("history").value.trim().split("\n");
 const historySet=new Set();
 const freq={};

 lines.forEach(l=>{
  const n=l.split(/[, ]+/).map(x=>+x).sort((a,b)=>a-b);
  if(n.length===5){
   historySet.add(n.join("-"));
   n.forEach(x=>freq[x]=(freq[x]||0)+1);
  }
 });

 const hotNumbers=getHotNumbers(freq);
 let pool=[];

 for(let a=1;a<=35;a++)
 for(let b=a+1;b<=36;b++)
 for(let c=b+1;c<=37;c++)
 for(let d=c+1;d<=38;d++)
 for(let e=d+1;e<=39;e++){
  let n=[a,b,c,d,e];

  if(c4.checked && historySet.has(n.join("-"))) continue;
  if(c7.checked && n.some(x=>hotNumbers.has(x))) continue;

  if(c1.checked){
   let s=1, ok=true;
   for(let i=1;i<5;i++){
    if(n[i]==n[i-1]+1){s++; if(s>=3) ok=false;}
    else s=1;
   }
   if(!ok) continue;
  }

  if(c2.checked){
   let d0=n[1]-n[0], ok=false;
   for(let i=1;i<4;i++) if(n[i+1]-n[i]!=d0) ok=true;
   if(!ok) continue;
  }

  if(c3.checked){
   let diffs=n.slice(1).map((v,i)=>v-n[i]);
   let avg=diffs.reduce((a,b)=>a+b)/diffs.length;
   if(diffs.every(d=>Math.abs(d-avg)<=1)) continue;
  }

  if(c5.checked){
   let small=n.filter(x=>x<=20).length;
   if(small===5 || small===0) continue;
  }

  if(c6.checked){
   let odd=n.filter(x=>x%2).length;
   if(!(odd===2 || odd===3)) continue;
  }

  let score=n.reduce((s,x)=>{
   let base=freq[x]||0;
   let balance=20-Math.abs(x-20);
   return s + base + balance*0.3;
  },0);

  pool.push({n,score});
 }

 shuffle(pool);
 pool.sort((a,b)=>b.score-a.score);

 let highPool=pool.slice(0,Math.max(100, pool.length*0.1));
 let need=+pick.value;
 let chosen=[];

 while(chosen.length<need && highPool.length){
  let r=highPool[Math.floor(Math.random()*highPool.length)];
  if(!chosen.some(x=>x.n.join()==r.n.join())) chosen.push(r);
 }

 let out=`<p>âœ… ç¯©é¸å¾Œå‰©é¤˜çµ„æ•¸ï¼š<b>${pool.length}</b></p><hr>`;
 chosen.forEach(x=>{
  out+=`<div class="result">ğŸ‘‰ ${x.n.join(", ")}</div>`;
 });

 output.innerHTML=out;
}

function clearAll(){
 history.value="";
 output.innerHTML="";
}
</script>
</body>
</html>
