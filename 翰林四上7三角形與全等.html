<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‰è§’å½¢é­”æ³•å¸«ï¼šèªè­˜å…¨ç­‰åœ–å½¢</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { touch-action: manipulation; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .animate-bounce-gentle { animation: bounce-gentle 2s infinite ease-in-out; }

        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(0.95); opacity: 0.5; }
        }
        .pulse-active { animation: pulse-ring 1.5s infinite; }

        .triangle-drop-shadow { filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1)); }
    </style>
</head>
<body class="bg-sky-50 text-slate-800 select-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- å°åœ–ç¤ºçµ„ä»¶ ---
        const Icon = ({ name, size = 24, className = "" }) => {
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        // --- æ ¸å¿ƒé‚è¼¯ï¼šApp ---
        const App = () => {
            const [tab, setTab] = useState('learn');
            const [score, setScore] = useState(0);
            const [showSuccess, setShowSuccess] = useState(false);

            useEffect(() => {
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }, [tab]);

            const triggerSuccess = () => {
                setShowSuccess(true);
                setTimeout(() => setShowSuccess(false), 2000);
            };

            return (
                <div className="h-[100dvh] flex flex-col max-w-md mx-auto bg-white shadow-2xl overflow-hidden relative">
                    {/* é é¦– */}
                    <header className="p-4 bg-white border-b border-sky-100 flex justify-between items-center z-10">
                        <div className="flex items-center gap-2">
                            <div className="bg-sky-500 p-2 rounded-xl text-white shadow-lg shadow-sky-200">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m3 21 9-18 9 18H3z"/></svg>
                            </div>
                            <h1 className="font-bold text-xl text-sky-800 tracking-tight">ä¸‰è§’å½¢é­”æ³•å¸«</h1>
                        </div>
                        <div className="flex items-center bg-yellow-100 px-3 py-1 rounded-full border border-yellow-200 shadow-sm">
                            <span className="text-yellow-600 font-bold mr-1">â­</span>
                            <span className="font-bold text-yellow-700">{score}</span>
                        </div>
                    </header>

                    {/* ä¸»è¦å…§å®¹å€ */}
                    <main className="flex-1 overflow-y-auto p-4 bg-gradient-to-b from-sky-50 to-white">
                        {tab === 'learn' && <LearnSection onNext={() => setTab('game1')} />}
                        {tab === 'game1' && <TriangleGame score={score} setScore={setScore} onNext={() => setTab('game2')} />}
                        {tab === 'game2' && <CongruentGame score={score} setScore={setScore} onNext={() => setTab('quiz')} />}
                        {tab === 'quiz' && <QuizSection score={score} setScore={setScore} onRestart={() => {setTab('learn'); setScore(0);}} />}
                    </main>

                    {/* åº•éƒ¨å°è¦½ */}
                    <nav className="bg-white border-t border-slate-100 p-2 pb-safe shadow-[0_-4px_10px_rgba(0,0,0,0.05)]">
                        <div className="flex justify-around items-center">
                            <NavBtn active={tab === 'learn'} icon="book-open" label="çœ‹å½±ç‰‡" onClick={() => setTab('learn')} />
                            <NavBtn active={tab === 'game1'} icon="shapes" label="æ‰¾ä¸‰è§’å½¢" onClick={() => setTab('game1')} />
                            <NavBtn active={tab === 'game2'} icon="layers" label="å…¨ç­‰ç–Šç–Šæ¨‚" onClick={() => setTab('game2')} />
                            <NavBtn active={tab === 'quiz'} icon="graduation-cap" label="å°æ¸¬é©—" onClick={() => setTab('quiz')} />
                        </div>
                    </nav>

                    {/* æˆåŠŸå‹•ç•« */}
                    {showSuccess && (
                        <div className="absolute inset-0 flex items-center justify-center bg-white/20 backdrop-blur-sm z-50 pointer-events-none">
                            <div className="bg-white p-8 rounded-full shadow-2xl animate-bounce">
                                <span className="text-6xl">ğŸ‰</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const NavBtn = ({ active, icon, label, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center p-2 rounded-2xl transition-all ${active ? 'text-sky-600 bg-sky-50' : 'text-slate-400'}`}>
                <Icon name={icon} size={24} className={active ? "stroke-[3px]" : ""} />
                <span className="text-xs font-bold mt-1">{label}</span>
            </button>
        );

        // --- 1. å­¸ç¿’å€ ---
        const LearnSection = ({ onNext }) => (
            <div className="space-y-6 animate-in fade-in duration-500">
                <div className="bg-white rounded-3xl overflow-hidden shadow-xl ring-4 ring-sky-100">
                    <div className="aspect-video bg-slate-900 relative">
                        {/* æ­¤è™•åµŒå…¥å‚™èª²ä¸€é»é€šæ•™å­¸å½±ç‰‡ */}
                        <iframe 
                            width="100%" 
                            height="100%" 
                            src="https://www.youtube.com/embed/9W16KByv9uU" 
                            title="ä¸‰è§’å½¢èˆ‡å…¨ç­‰æ•™å­¸" 
                            frameBorder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowFullScreen
                            className="absolute inset-0"
                        ></iframe>
                    </div>
                    <div className="p-4 bg-white">
                        <h2 className="text-lg font-bold text-sky-900">èªè­˜ä¸‰è§’å½¢èˆ‡å…¨ç­‰</h2>
                        <p className="text-slate-500 text-sm mt-1">é‡é»ï¼šä¸‰æ¢ç·šã€ä¸‰å€‹è§’ã€å…¨ç­‰å°±æ˜¯ç–Šç–Šæ¨‚ï¼</p>
                    </div>
                </div>

                <div className="grid grid-cols-1 gap-4">
                    <div className="bg-white p-4 rounded-2xl shadow-sm border-2 border-sky-100 flex items-center gap-4">
                        <div className="bg-amber-100 p-3 rounded-full text-2xl">ğŸ“</div>
                        <div>
                            <h3 className="font-bold text-sky-800">ä¸‰è§’å½¢æ˜¯ä»€éº¼ï¼Ÿ</h3>
                            <p className="text-slate-600 text-sm">ç”± <span className="text-red-500 font-bold">3æ¢ç·š</span> åœèµ·ä¾†çš„å½¢ç‹€ã€‚</p>
                        </div>
                    </div>
                    
                    <div className="bg-white p-4 rounded-2xl shadow-sm border-2 border-emerald-100 flex items-center gap-4">
                        <div className="bg-emerald-100 p-3 rounded-full text-2xl">ğŸ‘¯</div>
                        <div>
                            <h3 className="font-bold text-emerald-800">å…¨ç­‰æ˜¯ä»€éº¼ï¼Ÿ</h3>
                            <p className="text-slate-600 text-sm">å½¢ç‹€å’Œå¤§å° <span className="text-emerald-600 font-bold">ä¸€æ¨¡ä¸€æ¨£</span>ã€‚</p>
                            <p className="text-xs text-slate-400 mt-1">ç–Šåœ¨ä¸€èµ·å‰›å‰›å¥½ï¼Œä¸æœƒå¤šä¹Ÿä¸æœƒå°‘ã€‚</p>
                        </div>
                    </div>
                </div>

                <button onClick={onNext} className="w-full py-4 bg-sky-500 text-white rounded-2xl font-bold text-lg shadow-lg shadow-sky-200 active:scale-95 transition-all flex items-center justify-center gap-2">
                    æˆ‘å­¸æœƒäº†ï¼Œé–‹å§‹é—–é—œ <Icon name="arrow-right" />
                </button>
            </div>
        );

        // --- 2. æ‰¾æ‰¾ä¸‰è§’å½¢å°éŠæˆ² (è¾¨è­˜æ¦‚å¿µ) ---
        const TriangleGame = ({ score, setScore, onNext }) => {
            const [level, setLevel] = useState(0);
            const [message, setMessage] = useState("è«‹æ‰¾å‡ºä¸‹é¢å“ªä¸€å€‹æ˜¯ã€Œä¸‰è§’å½¢ã€ï¼Ÿ");
            
            const challenges = [
                {
                    options: [
                        { type: 'triangle', color: '#3b82f6', d: "M50,10 L90,80 L10,80 Z" },
                        { type: 'circle', color: '#ef4444', d: "M50,50 m-40,0 a40,40 0 1,0 80,0 a40,40 0 1,0 -80,0" },
                        { type: 'square', color: '#10b981', d: "M20,20 H80 V80 H20 Z" }
                    ],
                    ansIdx: 0
                },
                {
                    options: [
                        { type: 'not-closed', color: '#f59e0b', d: "M50,10 L90,80 L10,80" }, // æ²’é—œå¥½
                        { type: 'triangle', color: '#8b5cf6', d: "M50,10 L80,90 L20,70 Z" },
                        { type: 'curve', color: '#ec4899', d: "M50,10 C80,10 90,80 50,90 C10,80 20,10 50,10" }
                    ],
                    ansIdx: 1,
                    hint: "æ³¨æ„ï¼šè¦ä¸‰æ¢ç›´ç›´çš„ç·šï¼Œé‚„è¦é—œç·Šç·Šå–”ï¼"
                }
            ];

            const handleSelect = (idx) => {
                if (idx === challenges[level].ansIdx) {
                    setMessage("å¤ªæ£’äº†ï¼ä½ æ‰¾å°äº†ï¼");
                    setScore(s => s + 10);
                    setTimeout(() => {
                        if (level < challenges.length - 1) {
                            setLevel(l => l + 1);
                            setMessage("å†æ‰¾æ‰¾çœ‹ï¼Œå“ªå€‹ä¹Ÿæ˜¯ä¸‰è§’å½¢ï¼Ÿ");
                        } else {
                            onNext();
                        }
                    }, 1500);
                } else {
                    setMessage("å“å‘€ï¼Œå†çœ‹ä¸€æ¬¡ï¼Œå®ƒæœ‰ä¸‰æ¢ç·šå—ï¼Ÿ");
                }
            };

            return (
                <div className="h-full flex flex-col space-y-6 animate-in slide-in-from-right duration-300">
                    <div className="text-center mt-4">
                        <span className="bg-sky-100 text-sky-600 px-4 py-1 rounded-full text-xs font-bold">ç¬¬ä¸€é—œï¼šå½¢ç‹€è¾¨è­˜</span>
                        <h2 className="text-xl font-bold text-slate-800 mt-2 leading-relaxed">{message}</h2>
                        {challenges[level].hint && <p className="text-amber-600 text-xs mt-1 font-medium italic">ğŸ’¡ {challenges[level].hint}</p>}
                    </div>

                    <div className="grid grid-cols-1 gap-6 px-8 py-4">
                        {challenges[level].options.map((opt, i) => (
                            <button 
                                key={i} 
                                onClick={() => handleSelect(i)}
                                className="bg-white p-6 rounded-3xl shadow-md border-2 border-slate-100 hover:border-sky-300 transition-all active:scale-90 flex justify-center items-center h-40"
                            >
                                <svg width="100" height="100" viewBox="0 0 100 100">
                                    <path d={opt.d} fill={opt.color} className="triangle-drop-shadow" />
                                </svg>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 3. å…¨ç­‰ç–Šç–Šæ¨‚éŠæˆ² (å…¨ç­‰æ¦‚å¿µ) ---
        const CongruentGame = ({ score, setScore, onNext }) => {
            const [targetIdx, setTargetIdx] = useState(0);
            const [selectedIdx, setSelectedIdx] = useState(null);
            const [isOverlapping, setIsOverlapping] = useState(false);

            const shapes = [
                { id: 1, color: '#3b82f6', d: "M50,10 L90,90 L10,90 Z", label: 'è—è‰²é­”æ³•çŸ³' },
                { id: 2, color: '#f59e0b', d: "M10,10 L90,50 L10,90 Z", label: 'é»ƒè‰²é­”æ³•çŸ³' },
                { id: 3, color: '#10b981', d: "M50,10 L90,90 L10,90 Z", label: 'ç¶ è‰²é­”æ³•çŸ³' } // èˆ‡1å…¨ç­‰
            ];

            const checkCongruence = (idx) => {
                setSelectedIdx(idx);
                // æ¨¡æ“¬ç–Šåœ¨ä¸€èµ·çš„å‹•ä½œ
                setTimeout(() => {
                    if (idx === 2) { // ç¶ è‰²å’Œè—è‰²å…¨ç­‰
                        setIsOverlapping(true);
                        setScore(s => s + 20);
                        setTimeout(onNext, 2000);
                    } else {
                        setIsOverlapping(false);
                        setTimeout(() => setSelectedIdx(null), 1000);
                    }
                }, 600);
            };

            return (
                <div className="h-full flex flex-col items-center space-y-6">
                    <div className="text-center mt-4">
                        <span className="bg-emerald-100 text-emerald-600 px-4 py-1 rounded-full text-xs font-bold">ç¬¬äºŒé—œï¼šå…¨ç­‰ç–Šç–Šæ¨‚</span>
                        <h2 className="text-xl font-bold text-slate-800 mt-2">æ‰¾å‡ºè·Ÿã€Œè—è‰²ã€ä¸€æ¨¡ä¸€æ¨£çš„ä¸‰è§’å½¢ï¼</h2>
                    </div>

                    {/* å±•ç¤ºå€ï¼šç–Šç–Šæ¨‚æ¨¡æ“¬ */}
                    <div className="relative w-64 h-64 bg-slate-50 rounded-3xl border-4 border-dashed border-slate-200 flex items-center justify-center overflow-hidden">
                        {/* ç›®æ¨™å½¢ç‹€ (åº•åœ–) */}
                        <svg width="120" height="120" viewBox="0 0 100 100" className="absolute transition-all duration-500 opacity-30">
                            <path d={shapes[0].d} fill={shapes[0].color} />
                        </svg>

                        {/* é¸å–çš„å½¢ç‹€ (ç§»å‹•ä¸­çš„å‹•ç•«) */}
                        {selectedIdx !== null && (
                            <svg width="120" height="120" viewBox="0 0 100 100" 
                                className={`absolute transition-all duration-700 ease-in-out ${isOverlapping ? 'scale-100 rotate-0' : 'scale-75 translate-y-20 opacity-50'}`}
                                style={{ fill: shapes[selectedIdx].color }}
                            >
                                <path d={shapes[selectedIdx].d} />
                            </svg>
                        )}
                        
                        {!selectedIdx && <div className="text-slate-300 font-bold animate-pulse text-sm">é»é¸ä¸‹æ–¹å½¢ç‹€ç–Šéä¾†</div>}
                        {isOverlapping && <div className="absolute top-2 bg-emerald-500 text-white text-xs px-3 py-1 rounded-full font-bold animate-bounce">ç–Šåœ¨ä¸€èµ·å‰›å‰›å¥½ï¼</div>}
                    </div>

                    <div className="grid grid-cols-2 gap-4 w-full">
                        {shapes.slice(1).map((shape, i) => (
                            <button 
                                key={i+1}
                                onClick={() => checkCongruence(i+1)}
                                disabled={selectedIdx !== null}
                                className="bg-white p-4 rounded-2xl shadow-md border-2 border-slate-100 flex flex-col items-center gap-2 active:scale-95 transition-all"
                            >
                                <svg width="60" height="60" viewBox="0 0 100 100">
                                    <path d={shape.d} fill={shape.color} />
                                </svg>
                                <span className="text-xs font-bold text-slate-500">{shape.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 4. ç¶œåˆå°æ¸¬é©— ---
        const QuizSection = ({ score, setScore, onRestart }) => {
            const [qIdx, setQIdx] = useState(0);
            const [finished, setFinished] = useState(false);
            const [feedback, setFeedback] = useState(null);

            const questions = [
                {
                    q: "ä¸‰è§’å½¢æœ‰å¹¾æ¢é‚Šï¼Ÿ",
                    options: ["2 æ¢", "3 æ¢", "4 æ¢"],
                    ans: 1
                },
                {
                    q: "å…©å€‹ä¸‰è§’å½¢ã€Œå…¨ç­‰ã€ï¼Œä»£è¡¨å®ƒå€‘æœƒï¼Ÿ",
                    options: ["é•·å¾—ä¸ä¸€æ¨£", "ç–Šåœ¨ä¸€èµ·å‰›å‰›å¥½", "åªæœ‰é¡è‰²ä¸€æ¨£"],
                    ans: 1
                },
                {
                    q: "é€™å…©å€‹æ˜¯ä¸€æ¨£å¤§çš„ä¸‰è§’å½¢ï¼Œå®ƒå€‘æ˜¯ï¼Ÿ",
                    options: ["å…¨ç­‰åœ–å½¢", "ä¸å…¨ç­‰åœ–å½¢", "é•·æ–¹å½¢"],
                    ans: 0
                }
            ];

            const handleAns = (idx) => {
                if (feedback) return;
                if (idx === questions[qIdx].ans) {
                    setFeedback('correct');
                    setScore(s => s + 20);
                } else {
                    setFeedback('wrong');
                }

                setTimeout(() => {
                    if (qIdx < questions.length - 1) {
                        setQIdx(q => q + 1);
                        setFeedback(null);
                    } else {
                        setFinished(true);
                    }
                }, 1200);
            };

            if (finished) return (
                <div className="text-center py-10 space-y-8 animate-in zoom-in duration-500">
                    <div className="relative inline-block">
                        <div className="text-8xl animate-bounce-gentle">ğŸ†</div>
                        <div className="absolute -top-4 -right-4 text-4xl">âœ¨</div>
                    </div>
                    <div>
                        <h2 className="text-3xl font-bold text-sky-900 mb-2">æŒ‘æˆ°æˆåŠŸï¼</h2>
                        <p className="text-slate-500 font-medium italic">ä½ å·²ç¶“æ˜¯ä¸‰è§’å½¢å°ˆå®¶äº†ï¼</p>
                    </div>
                    <div className="bg-white p-8 rounded-3xl shadow-xl border-2 border-sky-100">
                        <p className="text-slate-400 text-sm font-bold uppercase tracking-widest mb-1">ç¸½å¾—åˆ†</p>
                        <div className="text-6xl font-black text-sky-500">{score}</div>
                    </div>
                    <button onClick={onRestart} className="w-full py-4 bg-slate-800 text-white rounded-2xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all">
                        <Icon name="rotate-ccw" /> å†ç©ä¸€æ¬¡
                    </button>
                </div>
            );

            const q = questions[qIdx];

            return (
                <div className="h-full flex flex-col pt-4">
                    <div className="flex justify-between items-center mb-6">
                        <span className="text-slate-400 font-bold">ç¬¬ {qIdx + 1} / {questions.length} é¡Œ</span>
                        <div className="flex gap-1">
                            {questions.map((_, i) => (
                                <div key={i} className={`h-2 w-8 rounded-full transition-all ${i <= qIdx ? 'bg-sky-500' : 'bg-slate-200'}`}></div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-white p-8 rounded-3xl shadow-md border-2 border-sky-100 mb-8 relative overflow-hidden">
                        <div className="absolute -top-4 -right-4 opacity-5 text-8xl font-black">Q</div>
                        <h3 className="text-xl font-bold text-slate-700 leading-relaxed text-center">
                            {q.q}
                        </h3>
                    </div>

                    <div className="space-y-4">
                        {q.options.map((opt, i) => (
                            <button
                                key={i}
                                onClick={() => handleAns(i)}
                                disabled={!!feedback}
                                className={`w-full py-5 px-6 rounded-2xl font-bold text-lg border-2 transition-all flex items-center justify-between
                                    ${feedback === 'correct' && i === q.ans ? 'bg-emerald-100 border-emerald-500 text-emerald-700' : 
                                      feedback === 'wrong' && i !== q.ans && feedback ? 'opacity-30 scale-95' :
                                      'bg-white border-slate-200 hover:border-sky-300 text-slate-600'
                                    }`}
                            >
                                <div className="flex items-center gap-4">
                                    <span className={`w-8 h-8 rounded-full flex items-center justify-center text-sm ${feedback === 'correct' && i === q.ans ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400'}`}>
                                        {String.fromCharCode(65 + i)}
                                    </span>
                                    {opt}
                                </div>
                                {feedback === 'correct' && i === q.ans && <Icon name="check-circle-2" className="text-emerald-500" />}
                            </button>
                        ))}
                    </div>
                    
                    {feedback === 'wrong' && <div className="mt-4 text-center font-bold text-red-400 animate-pulse italic text-sm">å†æƒ³ä¸€ä¸‹å–”ï¼Œä½ å¯ä»¥çš„ï¼</div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>